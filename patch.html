<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="utf-8">
 <title>Patch: a micro language to make pretty deep links easy</title>
 <script>/* This HTML was generated by ðŸ“œ Scroll v106.0.0. https://scroll.pub */</script>
 <style>@media print {.doNotPrint {display: none !important;}}</style>
 <link rel="canonical" href="https://breckyunits.com/patch.html">
 <meta name="viewport" content="width=device-width,initial-scale=1">
 <meta name="description" content="gazetteHeader">
 <meta name="generator" content="Scroll v106.0.0">
 <meta property="og:title" content="Patch: a micro language to make pretty deep links easy">
 <meta property="og:description" content="gazetteHeader">
 <meta property="og:image" content="">
 <link rel="alternate" type="application/rss+xml" title="Patch: a micro language to make pretty deep links easy" href="feed.xml">
 <meta name="twitter:card" content="summary_large_image">
</head>
<body>
<link rel="stylesheet" type="text/css" href="gazette.css"></link>

<p class="scrollParagraph">gazetteHeader</p>
<style>img {border: 2px solid #e9e9e9; border-radius: 5px;}</style>
<script>
document.addEventListener("DOMContentLoaded", () => document.querySelectorAll(".scrollCodeBlock").forEach(block =>
 {
  if (!navigator.clipboard) return
  const button = document.createElement("span")
  button.classList.add("scrollCopyButton")
  block.appendChild(button)
  button.addEventListener("click", async () => {
    await navigator.clipboard.writeText(block.innerText)
    button.classList.add("scrollCopiedButton")
  })
 }
))
</script>


<div class="scrollSection"><h1 class="scrollTitle"><a href="patch.html">Patch: a micro language to make pretty deep links easy</a></h1>
<div style="text-align: center;" class="scrollDateline">May 27, 2024</div>
</div>
<div class="scrollColumns" style="column-width:65ch;column-count:1;max-width:65ch;">
<p class="scrollParagraph">Patch is a tiny Javascript class (1k compressed) with zero dependencies that makes pretty deep links easy.</p>
<p class="scrollParagraph">Patch can be used with both:</p>
<ul ><li >?queryStrings</li>
<li >#hashStrings</li></ul>
<p class="scrollParagraph">Patch handles encoding and decoding for you, and makes your deep links pretty, so you don't have to think about it.</p>
<div class="scrollSection"><h1 class="scrollParagraph">Example</h1>
<p class="scrollParagraph">This object:</p>
<code class="scrollCodeBlock">{
  "countries": [
    "Canada",
    "France"
  ],
  "selection": "France"
}</code>
<p class="scrollParagraph">Becomes <code>countries=Canada=France&selection=France</code> (and vice versa).</p>
</div>
<div class="scrollSection"><h1 class="scrollParagraph">How to use</h1>
<script src="patch/patch.js"></script>
<ol  start="1."><li >Include patch.js or just <a href="patch.js">copy/paste the code</a>:</li></ol>
</div>
<code class="scrollCodeBlock">&lt;script src="patch.js">&lt;/script></code>
<ol  start="2."><li >Give your Javascript object to Patch, and it will give you the prettiest query string it can make:</li></ol>
<code class="scrollCodeBlock">window.location.hash = new Patch(
{
  "countries": [
    "Canada",
    "France"
  ],
  "selection": "France"
}
 ).uriEncodedString</code>
<ol  start="3."><li >Give Patch a query string, and it will give you back your Javascript object:</li></ol>
<code class="scrollCodeBlock">console.log(new Patch(window.location.hash).object)</code>
<div class="dinkus"><span>*</span></div>
<div class="scrollSection"><h1 class="scrollParagraph">Specification</h1>
<p class="scrollParagraph"><strong>They key idea of Patch is to think of your query params as a spreadsheet.</strong></p>
</div>
<p class="scrollParagraph">Then Patch encodes and decodes that spreadsheet.</p>
<p class="scrollParagraph">A Patch object has 4 forms:</p>
<div class="scrollSection"><h2 class="scrollParagraph">1. Spreadsheet Form</h2>
<code class="scrollCodeBlock">countries	Canada	France
selection	France</code>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">2. URI form</h2>
<code class="scrollCodeBlock">countries=Canada=France&selection=France</code>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">3. Object Form</h2>
<code class="scrollCodeBlock">{
 "countries": ["Canada", "France"],
 "selection": ["France"],
}</code>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">4. Matrix Form</h2>
<code class="scrollCodeBlock">[
 ["countries", "Canada", "France"],
 ["selection", "France"],
]</code>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">Delimiters</h2>
<p class="scrollParagraph">Patch requires 2 delimiters, one for separating "rows" and one for separating "columns".</p>
</div>
<p class="scrollParagraph">The default is <code>&</code> for rows and <code>=</code> for columns.</p>
<p class="scrollParagraph">You can change these to suit your own needs.</p>
<div class="scrollSection"><h2 class="scrollParagraph">Spaces</h2>
<p class="scrollParagraph">Patch encodes spaces to <code>+</code> instead of <code>%20</code> and uses the standard encoding of <code>+</code> to <code>%2B</code>.</p>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">URI Encoding</h2>
<p class="scrollParagraph">String inputs to the Patch constructor are assumed to be encoded and will be decoded before parsing. Similarly the string output is always encoded.</p>
</div>
<div class="scrollSection"><h2 class="scrollParagraph">Scalar Types</h2>
<p class="scrollParagraph">Patch treats all scalars as strings. Do a just-in-time parse of numbers, booleans, or JSON values if needed.</p>
</div>
<div class="dinkus"><span>*</span></div>
<div class="scrollSection"><h1 class="scrollParagraph">Why Patch?</h1>
<p class="scrollParagraph">QueryStrings can be thought of as a domain specific language for describing this structure:</p>
</div>
<code class="scrollCodeBlock">type QueryStrings = Omit&lt;string, [RestrictedCharacters]>
Map&lt;QueryStrings, QueryStrings></code>
<ul ><li >QueryStrings has one very restricted string type and a simple map type.</li>
<li >QueryStrings arguably adds little to no value on top of just a single string.</li>
<li >QueryStrings requires you encode and decode each map pair separately.</li>
<li >JSON is an alternative to Patch, except after uriEncoding JSON you lose almost all human editability in query strings.</li></ul>
<div class="scrollSection"><h1 class="scrollParagraph">Some benefits of Patch</h1>
<ul ><li >Encode and decode your params just once.</li>
<li >Cleanly encodes arrays and nested structures.</li>
<li >Very easy to debugâ€”it's just a patch!</li></ul>
</div>
<div class="scrollSection"><h1 class="scrollParagraph">Live examples of Patch</h1>
<ul ><li ><a href="search.html#q=patch">This blog</a></li>
<li ><a href="https://pldb.io/lists/explorer.html#columns=rank~name~id~appeared~tags~creators~blog">PLDB</a></li></ul>
</div>
<div class="scrollSection"><h1 class="scrollParagraph">History</h1>
<p class="scrollParagraph">I made Patch in 2020 for <a href="https://ourworldindata.org">Our World in Data</a>.</p>
</div>
<p class="scrollParagraph">This is an updated fork.</p>
</div>
<div class="scrollKeyboardNav" style="display:none;"><a href="pcri.html">pcri.html</a> Â· patch.html Â· <a href="meaning.html">meaning.html</a><script>document.addEventListener('keydown', function(event) {
  if (document.activeElement !== document.body) return
  const getLinks = () => document.getElementsByClassName("scrollKeyboardNav")[0].getElementsByTagName("a")
  if (event.key === "ArrowLeft")
    getLinks()[0].click()
  else if (event.key === "ArrowRight")
    getLinks()[1].click()
 });</script></div>
<p class="scrollParagraph">gazetteFooter</p>
</body>
</html>